(this.webpackJsonpkhoto=this.webpackJsonpkhoto||[]).push([[0],{136:function(e,t,n){"use strict";(function(e){var a=n(10),s=n.n(a),o=n(20),i=n(25),r=n(26),c=n(28),l=n(27),u=n(0),d=n.n(u),m=n(29),h=n.n(m),p=n(2),g=n(169),f="aes256",v=function(t){Object(c.a)(a,t);var n=Object(l.a)(a);function a(t){var r;return Object(i.a)(this,a),(r=n.call(this,t)).componentDidUpdate=function(e){if(null===r.props.url&&""===r.props.url){console.log("Canvas::componnentDidUpdate - blank or null url");var t=document.getElementById("myCanvas");t.width=window.innerWidth,t.height=window.innerHeight;var n=t.getContext("2d");n.fillStyle="grey",n.fillRect(0,0,t.width,t.height)}else r.props.url===e.url?null===r.image||(console.log("Canvas::componnentDidUpdate - Redraw existing image"),r.showImage(r.image)):(console.log("Canvas::componentDidUpdatem- Full fetch and render"),r.setImage(r.props.url))},r.setImage=Object(o.a)(s.a.mark((function t(){var n,a,o,i,c,l,u;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==r.props.url){t.next=3;break}return console.log("Canvas::setImage Blank url, Skipping."),t.abrupt("return");case 3:return console.log("Canvas::setImage Retreiving: ".concat(r.props.url)),t.prev=4,t.next=7,h()({method:"get",url:r.props.url,responseType:"text",headers:{"Access-Control-Allow-Origin":"*"}});case 7:n=t.sent,a=new e(n.data,"base64"),o=null,""!==r.props.password?(i=g.createHash("sha256").update(String(r.props.password)).digest("base64").substr(0,32),c=e.alloc(16,0),l=g.createDecipheriv(f,i,c),o=e.from(l.update(a),"binary"),o=e.concat([o,l.final()])):(console.log("Canvas::setImage: No key, Skipping decryption."),o=a),(u=new Image).onload=function(){r.image=u,r.showImage(u)},u.onerror=function(){r.image=null;var e=document.getElementById("myCanvas");e.width=window.innerWidth,e.height=window.innerHeight;var t=e.getContext("2d");t.fillStyle="grey",t.fillRect(0,0,e.width,e.height)},u.src="data:image/"+r.props.type+";base64,"+new e(o).toString("base64"),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(4),console.error("Viewer::loadImageList failed: ".concat(t.t0));case 20:case"end":return t.stop()}}),t,null,[[4,17]])}))),r.showImage=function(e){var t=document.getElementById("myCanvas");t.width=window.innerWidth,t.height=window.innerHeight;var n=t.getContext("2d"),a=e.width/e.height,s=t.width,o=s/a;o>t.height&&(s=(o=t.height)*a);var i=0,r=0;s<t.width&&(i=(t.width-s)/2),o<t.height&&(r=(t.height-o)/2),n.fillRect(0,0,t.width,t.height),n.drawImage(e,i,r,s,o)},r.image=null,r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){console.log("Canvas::componentDidMount: ".concat(this.props.url)),null!==this.props.url&&""!==this.props.url&&this.setImage(this.props.url)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return Object(p.jsx)("canvas",{id:"myCanvas"})}}]),a}(d.a.Component);t.a=v}).call(this,n(9).Buffer)},142:function(e,t,n){},165:function(e,t,n){},171:function(e,t){},173:function(e,t){},185:function(e,t){},187:function(e,t){},21:function(e){e.exports=JSON.parse('{"defaultSite":"","defaultName":"","defaultPassword":"","proto":"https","protoX":"http","publicUrlPrefix":""}')},214:function(e,t){},216:function(e,t){},217:function(e,t){},222:function(e,t){},224:function(e,t){},243:function(e,t){},255:function(e,t){},258:function(e,t){},264:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),o=n(134),i=n.n(o),r=n(73),c=(n(142),n(43)),l=n(25),u=n(26),d=n(28),m=n(27),h=n(8),p=n(266),g=n(267),f=n(135),v=n(268),b=n(269),w=n(2),x=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).setValue=function(e){switch(e.target.id){case"siteForm":a.setState({site:e.target.value});break;case"nameForm":a.setState({name:e.target.value});break;case"passwordForm":a.setState({password:e.target.value});break;default:console.warn("Login::setValue unexpected id: ".concat(e.target.id))}},a.validateForm=function(){return a.state.name.length>0&&a.state.password.length>0},a.handleSubmit=function(e){e.preventDefault(),a.props.updateCredentials(a.state.site,a.state.name,a.state.password)},a.state={site:a.props.site,name:a.props.name,password:a.props.password},a}return Object(u.a)(n,[{key:"render",value:function(){return Object(w.jsxs)("div",{className:"Login",children:[Object(w.jsx)(p.a,{children:Object(w.jsxs)(g.a,{children:[Object(w.jsx)(f.a,{sm:"4"}),Object(w.jsx)(f.a,{sm:"auto",children:Object(w.jsx)("h1",{children:"Khoto"})}),Object(w.jsx)(f.a,{xs:!0,lg:"4"})]})}),Object(w.jsxs)(v.a,{onSubmit:this.handleSubmit,children:[Object(w.jsxs)(v.a.Group,{as:g.a,controlId:"siteForm",children:[Object(w.jsx)(v.a.Label,{column:!0,sm:{span:2,offset:1},children:"Site:"}),Object(w.jsx)(f.a,{sm:5,children:Object(w.jsx)(v.a.Control,{type:"text",placeholder:"host.com:12345",value:this.state.site,onChange:this.setValue})})]}),Object(w.jsxs)(v.a.Group,{as:g.a,controlId:"nameForm",children:[Object(w.jsx)(v.a.Label,{column:!0,sm:{span:2,offset:1},children:"Name:"}),Object(w.jsx)(f.a,{sm:5,children:Object(w.jsx)(v.a.Control,{type:"text",value:this.state.name,onChange:this.setValue})})]}),Object(w.jsxs)(v.a.Group,{as:g.a,controlId:"passwordForm",children:[Object(w.jsx)(v.a.Label,{column:!0,sm:{span:2,offset:1},children:"Password:"}),Object(w.jsx)(f.a,{sm:5,children:Object(w.jsx)(v.a.Control,{type:"password",value:this.state.password,onChange:this.setValue})})]}),Object(w.jsx)(v.a.Group,{as:g.a,controlId:"MessageFormLabel",children:Object(w.jsx)(v.a.Label,{column:!0,sm:{span:5,offset:3},children:this.props.loginMessage})}),Object(w.jsx)(v.a.Group,{as:g.a,children:Object(w.jsx)(f.a,{sm:{span:3,offset:3},children:Object(w.jsx)(b.a,{type:"submit",disabled:!this.validateForm(),children:"Submit"})})}),Object(w.jsx)(v.a.Group,{as:g.a,children:Object(w.jsx)(v.a.Label,{column:!0,sm:{span:2,offset:1},children:this.props.message})})]})]})}}]),n}(s.a.Component),j=n(10),O=n.n(j),I=n(20),y=n(29),k=n.n(y),L=(n(165),n(136));var S=function(e){return Object(w.jsx)("button",{id:"nextButton",className:"float-button-next",onClick:e.handleOnNext,children:">"})};var C=function(e){return Object(w.jsx)("button",{id:"prevButton",className:"float-button-prev",onClick:e.handleOnPrev,children:"<"})};var E=function(e){var t=e.albums.map((function(e){return Object(w.jsx)("option",{value:e,children:e},e)}));return Object(w.jsx)("select",{id:"albumSelect",className:"float-select",value:e.selectedAlbum,onChange:e.handleChange,children:t})};var B=function(e){return Object(w.jsx)("div",{id:"imageSlider",className:"slidecontainer",children:Object(w.jsx)("input",{className:"slider",id:"myRange",type:"range",min:"0",max:e.max,value:e.current,onChange:e.handleChange})})};var F=function(e){return Object(w.jsx)("button",{id:"toggleButton",className:"float-button-toggle",onClick:e.handleOnToggle,children:"[ - ]"})},N=n(21);function U(e,t,n){return A.apply(this,arguments)}function A(){return(A=Object(I.a)(O.a.mark((function e(t,n,a){var s,o,i;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="".concat(N.proto,"://").concat(t,"/api/user/").concat(n,"/setting/key/").concat(a),o="",e.prev=2,e.next=5,k()({method:"get",url:s,responseType:"text",headers:{"Access-Control-Allow-Origin":"*"}});case 5:i=e.sent,o=i.data,e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("loadSetting caught for ".concat(a)),o="";case 13:return void 0!==typeof o&&"undefined"!==o||(console.log("Settings::loadSetting query for user: ".concat(n," and key: ").concat(a,' is undefined, setting to ""')),o=""),console.log("Settings::loadSetting result for ".concat(a,": ").concat(o)),e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,null,[[2,9]])})))).apply(this,arguments)}function T(e,t,n,a){return V.apply(this,arguments)}function V(){return(V=Object(I.a)(O.a.mark((function e(t,n,a,s){var o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o="".concat(N.proto,"://").concat(t,"/api/user/").concat(n,"/setting/key/").concat(a,"/value/").concat(s);try{k()({method:"post",url:o,responseType:"json",headers:{"Access-Control-Allow-Origin":"*"}})}catch(i){console.log("Viewer::saveSetting failed: ".concat(i))}case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).handleAlbumChange=function(){var e=Object(I.a)(O.a.mark((function e(t){var n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.value,console.log("New Album selected:",n),T(a.props.site,a.props.name,"lastAlbum",n),e.next=5,a.loadImageList(n);case 5:a.imageList=e.sent,console.log("Viewer::handleAlbumChange album=".concat(n," Index= 0 - assigning new Image Url")),a.assignNewImageUrl(n,0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleSliderChange=function(e){console.log("Viewer::handlSliderChange - New: ".concat(e.target.value,", Max: ").concat(a.state.imageListLength)),a.assignNewImageUrl(a.state.activeAlbum,e.target.value)},a.handleResize=function(){a.assignNewImageUrl(a.state.activeAlbum,a.state.activeImageIndex)},a.assignNewImageUrl=function(e,t){T(a.props.site,a.props.name,"lastIndex",t);var n="".concat(a.state.baseUrl,"/base64Image/albumName/").concat(e,"/imageName/").concat(a.imageList[t]),s="",o=a.state.password;try{a.imageList[t].endsWith("daj")?s="jpeg":a.imageList[t].endsWith("dag")?s="gif":a.imageList[t].endsWith("dap")?s="png":a.imageList[t].endsWith("jpeg")||a.imageList[t].endsWith("jpg")?(s="jpeg",o=""):a.imageList[t].endsWith("png")?(s="png",o=""):a.imageList[t].endsWith("gif")&&(s="gif",o=""),a.setState({activeUrl:n,imageType:s,activeAlbum:e,imageListLength:a.imageList.length,activeImageIndex:t,imagePassword:o})}catch(i){console.error("Viewer::assignNewImageUrl failed, skipping ".concat(i))}},a.loadAlbumList=Object(I.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.baseUrl+"/albums",e.next=3,k()({method:"get",url:t,responseType:"json",headers:{"Access-Control-Allow-Origin":"*"}});case 3:return n=e.sent,e.abrupt("return",n.data);case 5:case"end":return e.stop()}}),e)}))),a.loadImageList=function(){var e=Object(I.a)(O.a.mark((function e(t){var n,s,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.baseUrl+"/album/albumName/"+t,s=[],e.prev=2,e.next=5,k()({method:"get",url:n,responseType:"json",headers:{"Access-Control-Allow-Origin":"*"}});case 5:o=e.sent,s=o.data,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:return e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}(),a.handleNext=function(){if(a.state.activeImageIndex<a.state.imageListLength-1){var e=a.state.activeImageIndex;e++,a.assignNewImageUrl(a.state.activeAlbum,e)}},a.handlePrev=function(){if(a.state.activeImageIndex>0){var e=a.state.activeImageIndex;e--,a.assignNewImageUrl(a.state.activeAlbum,e)}},a.handleKey=function(e){var t=e.which||e.keyCode;32===t||39===t?a.handleNext():37===t?a.handlePrev():27===t?a.closeFullscreen():81===t?(a.setState({activeUrl:null}),a.props.exitViewer("Logout")):66===t?a.bookmarkIndex=a.state.activeImageIndex:71===t&&a.assignNewImageUrl(a.state.activeAlbum,a.bookmarkIndex)},a.handleClick=function(e){a.isInFullScreen()&&(0===e.button?a.handlePrev():1===e.button?(a.setState({activeUrl:null}),a.props.exitViewer("Logout")):2===e.button&&a.handleNext())},a.handleRightClick=function(e){e.preventDefault()},a.handleWheel=function(e){e.deltaY<0?a.handlePrev():e.deltaY>0?a.handleNext():console.warn("Viewer::onWheel - not an up/down")},a.handleTouchStart=function(e){e.preventDefault(),a.touchStartX=e.touches[0].clientX,a.touchStartY=e.touches[0].clientY,console.log("TouchStart - X=".concat(a.touchStartX," Y=").concat(a.touchStartY))},a.handleTouchMove=function(e){console.log("handleTouchEnd: "+JSON.stringify(e,void 0,2)),e.preventDefault();var t=e.touches[0].clientX,n=e.touches[0].clientY;if(console.log("TouchEnd - X=".concat(t," Y=").concat(n)),null!==a.touchStartX)if(null!==a.touchStartY){var s=a.touchStartX-t,o=a.touchStartY-n;Math.abs(s)>Math.abs(o)?s>0?(console.log("swiped left"),a.handleNext()):(console.log("swiped right"),a.handlePrev()):o>0?(console.log("swiped up"),a.props.exitViewer("Logout")):console.log("swiped down"),a.touchStartX=null,a.touchStartY=null}else console.log("No initial Y");else console.log("No initial X")},a.showControls=function(){try{a.isInFullScreen()?(document.getElementById("imageSlider").classList.remove("k-fadeOut"),document.getElementById("imageSlider").classList.add("k-fadeIn")):(document.getElementById("prevButton").classList.remove("k-fadeOut"),document.getElementById("nextButton").classList.remove("k-fadeOut"),document.getElementById("albumSelect").classList.remove("k-fadeOut"),document.getElementById("imageSlider").classList.remove("k-fadeOut"),document.getElementById("toggleButton").classList.remove("k-fadeOut"),document.getElementById("prevButton").classList.add("k-fadeIn"),document.getElementById("nextButton").classList.add("k-fadeIn"),document.getElementById("albumSelect").classList.add("k-fadeIn"),document.getElementById("imageSlider").classList.add("k-fadeIn"),document.getElementById("toggleButton").classList.add("k-fadeIn")),null!==a.timeout&&(clearTimeout(a.timeout),a.timeout=null),a.timeout=setTimeout((function(){a.hideControls()}),2e3)}catch(e){}},a.hideControls=function(){try{document.getElementById("prevButton").classList.remove("k-fadeIn"),document.getElementById("nextButton").classList.remove("k-fadeIn"),document.getElementById("albumSelect").classList.remove("k-fadeIn"),document.getElementById("imageSlider").classList.remove("k-fadeIn"),document.getElementById("toggleButton").classList.remove("k-fadeIn"),document.getElementById("prevButton").classList.add("k-fadeOut"),document.getElementById("nextButton").classList.add("k-fadeOut"),document.getElementById("albumSelect").classList.add("k-fadeOut"),document.getElementById("imageSlider").classList.add("k-fadeOut"),document.getElementById("toggleButton").classList.add("k-fadeOut")}catch(e){}},a.handleFullscreenToggle=function(){a.isInFullScreen()?a.closeFullscreen():a.openFullscreen()},a.isInFullScreen=function(){return document.fullscreenElement&&null!==document.fullscreenElement||document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||document.mozFullScreenElement&&null!==document.mozFullScreenElement||document.msFullscreenElement&&null!==document.msFullscreenElement},a.openFullscreen=function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},a.closeFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},a.state={baseUrl:"".concat(N.proto,"://").concat(a.props.site,"/api/user/").concat(a.props.name),password:a.props.password,activeUrl:"",albumList:[""],activeAlbum:"",activeImageIndex:0,imageListLength:0,imageType:"",imagePassword:a.props.password},""===a.props.name&&(console.warn("No name.  Pushing to login"),a.setState({activeUrl:null}),a.props.exitViewer("No name")),a.imageList=[],a.timeout=null,a.touchStartX=null,a.touchStartY=null,a}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var e=Object(I.a)(O.a.mark((function e(){var t,n,a,s,o=this;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.timeout=setTimeout((function(){o.hideControls()}),3e3),e.prev=1,e.next=4,this.loadAlbumList();case 4:return t=e.sent,e.next=7,U(this.props.site,this.props.name,"lastAlbum");case 7:return""===(n=e.sent)&&(n=t[0],T(this.props.site,this.props.name,"lastAlbum",n)),e.next=11,this.loadImageList(n);case 11:return this.imageList=e.sent,e.next=14,U(this.props.site,this.props.name,"lastIndex");case 14:""===(a=e.sent)&&(console.log("Viewer::componentDidMount: newActiveImageIndex blank, setting to 0"),a=0),this.bookmarkIndex=a,this.assignNewImageUrl(n,a),s={albumList:t},this.setState(s),e.next=28;break;case 22:e.prev=22,e.t0=e.catch(1),console.error("Viewer::componentDidMount Catch = ".concat(e.t0,".  Pushing to login")),null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.setState({activeUrl:null}),this.props.exitViewer("No access");case 28:document.addEventListener("keydown",this.handleKey),document.addEventListener("wheel",this.handleWheel),document.addEventListener("mousemove",this.showControls),document.addEventListener("mousedown",this.handleClick),document.addEventListener("contextmenu",this.handleRightClick),document.addEventListener("touchstart",this.handleTouchStart),document.addEventListener("touchmove",this.handleTouchMove),window.addEventListener("resize",this.handleResize);case 37:case"end":return e.stop()}}),e,this,[[1,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKey),document.removeEventListener("wheel",this.handleWheel),document.removeEventListener("mousemove",this.showControls),document.removeEventListener("mousedown",this.handleClick),document.removeEventListener("contextmenu",this.handleRightClick),document.removeEventListener("touchstart",this.handleTouchStart),document.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("resize",this.handleResize),null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}},{key:"render",value:function(){return Object(w.jsxs)("div",{id:"myViewer",className:"Viewer",children:[Object(w.jsx)(E,{selectedAlbum:this.state.activeAlbum,handleChange:this.handleAlbumChange,albums:this.state.albumList}),Object(w.jsx)(L.a,{url:this.state.activeUrl,password:this.state.imagePassword,type:this.state.imageType}),Object(w.jsx)(S,{handleOnNext:this.handleNext}),Object(w.jsx)(C,{handleOnPrev:this.handlePrev}),Object(w.jsx)(B,{max:this.state.imageListLength-1,current:this.state.activeImageIndex,handleChange:this.handleSliderChange}),Object(w.jsx)(F,{handleOnToggle:this.handleFullscreenToggle})]})}}]),n}(s.a.Component),R=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this,e)).updateCredentials=function(e,t,n){console.log("App::updateCredentials: site = ".concat(e,", name = ").concat(t,", password = ").concat(n)),a.setState({site:e,name:t,password:n,toViewer:!0}),a.props.history.push(a.state.publicUrlPrefix+"/viewer")},a.exitViewer=function(e){console.log("App::exitViewer: message=".concat(e)),a.setState({loginMessage:e,toLogin:!0}),a.props.history.push(a.state.publicUrlPrefix+"/")},a.state={site:N.defaultSite,name:N.defaultName,password:N.defaultPassword,publicUrlPrefix:N.publicUrlPrefix,toViewer:!1,toLogin:!1,loginMessage:"Let's get started"},a}return Object(u.a)(n,[{key:"render",value:function(){var e=this;return Object(w.jsx)("div",{children:Object(w.jsxs)(h.c,{children:[Object(w.jsx)(h.a,{path:this.state.publicUrlPrefix+"/viewer",render:function(t){return Object(w.jsx)(P,Object(c.a)(Object(c.a)({},t),{},{site:e.state.site,name:e.state.name,password:e.state.password,exitViewer:e.exitViewer,component:P}))}}),Object(w.jsx)(h.a,{path:this.state.publicUrlPrefix+"/",render:function(t){return Object(w.jsx)(x,Object(c.a)(Object(c.a)({},t),{},{site:e.state.site,name:e.state.name,password:e.state.password,publicUrlPrefix:e.state.publicUrlPrefix,loginMessage:e.state.loginMessage,updateCredentials:e.updateCredentials}))}})]})})}}]),n}(s.a.Component),W=Object(h.f)(R);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(263);i.a.render(Object(w.jsx)(r.a,{children:Object(w.jsx)(W,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[264,1,2]]]);
//# sourceMappingURL=main.b82ec7ae.chunk.js.map